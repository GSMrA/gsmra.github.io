<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Login Discord</title>
</head>
<body>
  <h2>Connexion Discord</h2>
  
  <div id="step1">
    <label for="username">Nom d'utilisateur Discord :</label>
    <input type="text" id="username" placeholder="Nom d'utilisateur#1234" />
    <button onclick="requestCode()">Demander le code</button>
  </div>
  
  <div id="step2" style="display:none;">
    <label for="code">Entrez le code reçu :</label>
    <input type="text" id="code" placeholder="Code" />
    <button onclick="verifyCode()">Vérifier le code</button>
  </div>
  
  <div id="result"></div>
  
  <script>
    function requestCode() {
      const username = document.getElementById('username').value.trim();
      if (!username) {
        alert('Veuillez entrer votre nom d\'utilisateur Discord');
        return;
      }
      fetch(`https://devmra.pythonanywhere.com/code?user=${encodeURIComponent(username)}`)
        .then(response => response.text())
        .then(text => {
          document.getElementById('result').textContent = text;
          document.getElementById('step1').style.display = 'none';
          document.getElementById('step2').style.display = 'block';
        })
        .catch(err => {
          console.error(err);
          document.getElementById('result').textContent = "Attention : si vous entrez un NA incorrect ou si vous n'êtes pas dans le Discord GeekSoft, la validation du code échouera.";
          document.getElementById('step1').style.display = 'none';
          document.getElementById('step2').style.display = 'block';
        });
    }
    
    function verifyCode() {
      const username = document.getElementById('username').value.trim();
      const code = document.getElementById('code').value.trim();
      if (!code) {
        alert('Veuillez entrer le code');
        return;
      }
      fetch(`https://devmra.pythonanywhere.com/codeverif?code=${encodeURIComponent(code)}&user=${encodeURIComponent(username)}`)
        .then(response => response.text())
        .then(text => {
          if (text.toLowerCase() === 'true') {
            document.getElementById('result').textContent = 'Code vérifié avec succès. Connexion acceptée.';
          } else if (text.toLowerCase() === 'false') {
            document.getElementById('result').textContent = 'Code invalide. Veuillez réessayer.';
          } else {
            document.getElementById('result').textContent = 'Erreur : réponse inattendue du serveur.';
            console.error('Réponse inattendue:', text);
          }
        })
        .catch(err => {
          console.error(err);
          alert('Erreur lors de la vérification du code.');
        });
    }
  </script>
</body>
</html>
