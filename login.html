<!DOCTYPE html>
<html lang="fr">
<head>
  <title>Login - GeekSoft</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/png" href="GEEKSOFT.png">
  <style>
    :root{
      --black:#000;
      --white:#fff;
      --muted:#666;
      --glow:#ffffff;
      --gray-bg:#1e1e1e;
      --max-width:1100px;
    }
    html,body{
      height:100%;
      margin:0;
      font-family:'Arial Black', Impact, sans-serif;
      background:var(--gray-bg);
      color:#fff;
    }
    @keyframes slideDown {
      from { opacity:0; transform:translateX(-50%) translateY(-100px);}
      to   { opacity:1; transform:translateX(-50%) translateY(0);}
    }
    @keyframes fadeInUp {
      from { opacity:0; transform:translateY(30px);}
      to   { opacity:1; transform:translateY(0);}
    }
    @keyframes fadeIn {
      from { opacity:0; }
      to   { opacity:1; }
    }
    .topbar{
      position:fixed;
      top:20px;
      left:50%;
      transform:translateX(-50%);
      background:var(--black);
      color:var(--white);
      padding:28px 40px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      box-shadow:0 0 30px var(--glow), 0 8px 20px rgba(255,255,255,0.2);
      border-radius:24px;
      width:90%;
      max-width:1300px;
      z-index:1000;
      animation: slideDown 0.8s cubic-bezier(.44,1.3,.44,1) forwards;
    }
    .logo{
      height:70px;
      width:auto;
      display:block;
      filter:drop-shadow(0 0 15px var(--glow));
    }
    .title{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      font-weight:900;
      font-size:3.5rem;
      letter-spacing:3px;
      text-transform:uppercase;
      color:var(--white);
      text-shadow:0 0 15px var(--glow), 0 0 30px var(--glow);
    }
    .login-container{
      margin-top: 160px;
      max-width: 440px;
      padding: 32px 24px 24px 24px;
      background: #242424;
      border-radius: 16px;
      box-shadow: 0 6px 30px #000a;
      text-align: center;
      margin-left: auto;
      margin-right: auto;
      animation: fadeInUp 1s cubic-bezier(.44,1.3,.44,1) 0.2s both;
    }
    h1 {
      font-size: 2.1rem;
      margin-bottom: 24px;
      text-shadow: 0 2px 12px #fff1;
      animation: fadeIn 0.75s cubic-bezier(.44,1.3,.44,1) 0.4s both;
    }
    .login-field {
      width:82%;
      padding:12px 10px;
      margin:12px 0 20px 0;
      border-radius:9px;
      border:none;
      background:#363636;
      color:#fff;
      font-size:1.1rem;
      font-family:inherit;
      box-shadow:0 2px 8px #0006;
      outline:none;
      text-align: center;
      transition: background 0.2s;
      animation: fadeInUp 1s cubic-bezier(.44,1.3,.44,1) 0.5s both;
    }
    .login-field:focus {
      background:#444;
    }
    .login-btn {
      background: #47c5ff;
      color: #fff;
      border: none;
      border-radius: 7px;
      padding: 13px 36px;
      font-size: 1.15rem;
      font-weight: bold;
      cursor: pointer;
      margin-top:14px;
      transition: background 0.18s, color 0.18s;
      box-shadow: 0 2px 8px #0006;
      outline: none;
      animation: fadeInUp 1s cubic-bezier(.44,1.3,.44,1) 0.7s both;
    }
    .login-btn:hover {
      background: #0084ff;
      color: #fff;
    }
    .msg {
      margin:18px 0 12px 0;
      color:#fff;
      font-size:17px;
      word-break:break-all;
      min-height:25px;
      animation: fadeInUp 1s cubic-bezier(.44,1.3,.44,1) 0.8s both;
    }
    .avert {
      color: #ffae34;
      background: #222;
      padding: 12px 16px;
      border-radius: 7px;
      font-size: 15px;
      margin-bottom: 18px;
      box-shadow: 0 2px 7px #0004;
      animation: fadeInUp 1s cubic-bezier(.44,1.3,.44,1) 0.3s both;
    }
    .back-link {
      color: #888;
      display:inline-block;
      margin-top:26px;
      text-decoration:none;
      font-size: 15px;
      transition: color 0.2s;
      animation: fadeInUp 1s cubic-bezier(.44,1.3,.44,1) 1s both;
    }
    .back-link:hover {
      color: #47c5ff;
    }
    @media (max-width:480px){
      .logo{height:45px}
      .title{font-size:2rem;}
      .topbar{padding:16px;width:95%;border-radius:16px;}
      .login-container{max-width:98vw;}
      .avert{font-size:13px;}
    }
  </style>
</head>
<body>
  <header class="topbar">
    <img src="GEEKSOFT.png" alt="GEEKSOFT" class="logo" />
    <div class="title">GEEKSOFT</div>
  </header>
  <div class="login-container">
    <h1>Connexion</h1>
    <div class="avert">
      Attention : Si tu n'es pas membre du Discord GeekSoft ou si ton NA Discord est incorrect, tu ne recevras aucun code par message privé !
    </div>
    <div id="step1">
      <input type="text" id="username" class="login-field" placeholder="Nom d'utilisateur Discord" autocomplete="username" />
      <button class="login-btn" onclick="requestCode()">Demander le code</button>
    </div>
    <div id="step2" style="display:none;">
      <input type="text" id="code" class="login-field" placeholder="Code reçu par DM" autocomplete="one-time-code" />
      <button class="login-btn" onclick="verifyCode()">Vérifier le code</button>
    </div>
    <div id="result" class="msg"></div>
    <a class="back-link" href="index.html">Retour à l'accueil</a>
  </div>
  <script>
    function requestCode() {
      const username = document.getElementById('username').value.trim();
      if (!username) {
        alert('Veuillez entrer votre nom d\'utilisateur Discord');
        return;
      }
      fetch(`https://devmra.pythonanywhere.com/code?user=${encodeURIComponent(username)}`)
        .then(response => response.text())
        .then(() => {
          document.getElementById('result').textContent = "Un code vient d'être généré et envoyé dans vos DMs Discord. Vérifiez vos messages privés.";
          document.getElementById('step1').style.display = 'none';
          document.getElementById('step2').style.display = 'block';
        })
        .catch(err => {
          console.error(err);
          document.getElementById('result').textContent =
            "Attention : si vous entrez un NA incorrect ou si vous n'êtes pas dans le Discord GeekSoft, la validation du code échouera.";
          document.getElementById('step1').style.display = 'none';
          document.getElementById('step2').style.display = 'block';
        });
    }
    function verifyCode() {
      const username = document.getElementById('username').value.trim();
      const code = document.getElementById('code').value.trim();
      if (!code) {
        alert('Veuillez entrer le code');
        return;
      }
      fetch(`https://devmra.pythonanywhere.com/codeverif?code=${encodeURIComponent(code)}&user=${encodeURIComponent(username)}`)
        .then(response => response.text())
        .then(text => {
          if (text.toLowerCase() === 'true') {
            document.getElementById('result').textContent = 'Code vérifié avec succès. Connexion acceptée.';
          } else if (text.toLowerCase() === 'false') {
            document.getElementById('result').textContent = 'Code invalide. Veuillez réessayer.';
          } else {
            document.getElementById('result').textContent = 'Erreur : réponse inattendue du serveur.';
            console.error('Réponse inattendue:', text);
          }
        })
        .catch(err => {
          console.error(err);
          alert('Erreur lors de la vérification du code.');
        });
    }
  </script>
</body>
</html>
