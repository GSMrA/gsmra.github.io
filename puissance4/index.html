<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Puissance 4 - Ultimate</title>
    <style>
        :root {
            --cell-size: 60px;
            --board-gap: 8px;
            --p1-color: #ffcc00; /* Jaune Or */
            --p2-color: #ff3b30; /* Rouge Apple */
            --bg-color: #1a1a2e;
            --panel-bg: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: radial-gradient(circle at center, #2c3e50 0%, #000000 100%);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- MENU --- */
        #menu-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            animation: fadeIn 0.8s ease-out;
            z-index: 100;
        }

        h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #ffcc00, #ff3b30);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 4px 15px rgba(0,0,0,0.5);
            animation: float 3s ease-in-out infinite;
        }

        .menu-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 18px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            width: 280px;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            font-weight: 600;
            letter-spacing: 1px;
        }

        .menu-btn:hover {
            transform: scale(1.05) translateY(-3px);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 25px rgba(255, 255, 255, 0.2);
        }

        .menu-btn.pvp { border-left: 5px solid #ffcc00; }
        .menu-btn.pve { border-left: 5px solid #ff3b30; }
        .menu-btn.hard { border-left: 5px solid #00d2ff; }

        /* --- JEU --- */
        #game-screen {
            display: none; /* Cach√© par d√©faut */
            flex-direction: column;
            align-items: center;
            animation: slideUp 0.5s ease-out;
        }

        .header-bar {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 500px;
            margin-bottom: 20px;
            align-items: center;
        }

        .back-btn {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.3);
            color: rgba(255,255,255,0.7);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: 0.2s;
        }
        .back-btn:hover { background: rgba(255,255,255,0.1); color: white; }

        .status-text {
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
        }

        .board-container {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 25px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        .board {
            display: grid;
            grid-template-columns: repeat(7, var(--cell-size));
            grid-template-rows: repeat(6, var(--cell-size));
            gap: var(--board-gap);
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            background: rgba(0, 0, 0, 0.3);
            border-radius: 50%;
            cursor: pointer;
            position: relative;
            box-shadow: inset 0 3px 8px rgba(0,0,0,0.6);
        }

        /* Jeton */
        .token {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: absolute;
            top: 0; left: 0;
            transform: translateY(var(--drop-start));
            opacity: 0;
        }

        .token.p1 { 
            background: radial-gradient(circle at 35% 35%, #fff 2%, var(--p1-color) 40%); 
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.6);
        }
        .token.p2 { 
            background: radial-gradient(circle at 35% 35%, #fff 2%, var(--p2-color) 40%); 
            box-shadow: 0 0 15px rgba(255, 59, 48, 0.6);
        }

        .token.falling {
            animation: dropBounce 0.6s cubic-bezier(0.5, 0, 0.5, 1.5) forwards;
        }

        /* Animations Keyframes */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes dropBounce {
            0% { transform: translateY(var(--drop-start)); opacity: 1; }
            60% { transform: translateY(0); }
            80% { transform: translateY(-15px); }
            100% { transform: translateY(0); opacity: 1; }
        }

    </style>
</head>
<body>

    <!-- MENU PRINCIPAL -->
    <div id="menu-screen">
        <h1>Puissance 4</h1>
        <button class="menu-btn pvp" onclick="startGame('classic')">üë• 2 Joueurs Classique</button>
        <button class="menu-btn pve" onclick="startGame('ai')">ü§ñ Contre l'IA (Solo)</button>
        <button class="menu-btn hard" onclick="startGame('connect5')">üî• Mode 5 √† la suite</button>
    </div>

    <!-- ECRAN DE JEU -->
    <div id="game-screen">
        <div class="header-bar">
            <button class="back-btn" onclick="showMenu()">‚Üê Menu</button>
            <div id="status" class="status-text">Joueur 1</div>
            <div style="width: 70px;"></div> <!-- Spacer pour centrer le texte -->
        </div>

        <div class="board-container">
            <div class="board" id="board"></div>
        </div>
    </div>

    <script>
        const ROWS = 6;
        const COLS = 7;
        
        let boardState = [];
        let currentPlayer = 1;
        let gameActive = false;
        let currentMode = 'classic'; // 'classic', 'ai', 'connect5'
        let winCondition = 4; // 4 ou 5
        let isAiThinking = false;

        const boardEl = document.getElementById('board');
        const statusEl = document.getElementById('status');
        const menuScreen = document.getElementById('menu-screen');
        const gameScreen = document.getElementById('game-screen');

        // --- GESTION DES ECRANS ---

        function showMenu() {
            gameActive = false;
            gameScreen.style.display = 'none';
            menuScreen.style.display = 'flex';
        }

        function startGame(mode) {
            currentMode = mode;
            winCondition = (mode === 'connect5') ? 5 : 4;
            
            menuScreen.style.display = 'none';
            gameScreen.style.display = 'flex';
            
            initGame();
        }

        // --- MOTEUR DE JEU ---

        function initGame() {
            boardState = Array(ROWS).fill().map(() => Array(COLS).fill(0));
            boardEl.innerHTML = '';
            currentPlayer = 1;
            gameActive = true;
            isAiThinking = false;
            updateStatus("C'est parti ! Tour du Joueur 1");

            // Cr√©ation Grille
            for(let r=0; r<ROWS; r++){
                for(let c=0; c<COLS; c++){
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.r = r;
                    cell.dataset.c = c;
                    cell.onclick = () => handleInput(c);
                    boardEl.appendChild(cell);
                }
            }
        }

        function handleInput(col) {
            if (!gameActive || isAiThinking) return;

            if (playMove(col, currentPlayer)) {
                // Coup valide jou√©
                if(gameActive && currentMode === 'ai' && currentPlayer === 2) {
                    // Tour de l'IA
                    isAiThinking = true;
                    setTimeout(aiMove, 600); // Petit d√©lai pour le r√©alisme
                }
            }
        }

        function playMove(col, player) {
            // Trouver la ligne vide la plus basse
            let row = -1;
            for (let r = ROWS - 1; r >= 0; r--) {
                if (boardState[r][col] === 0) {
                    row = r;
                    break;
                }
            }

            if (row === -1) return false; // Colonne pleine

            // Logique
            boardState[row][col] = player;

            // Visuel
            animateToken(row, col, player);

            // V√©rif Victoire
            if (checkWin(row, col, player)) {
                gameActive = false;
                const winnerName = (currentMode === 'ai' && player === 2) ? "L'IA" : `Joueur ${player}`;
                updateStatus(`üèÜ ${winnerName} a gagn√© !`);
                return true;
            }

            // V√©rif Match Nul
            if (boardState.every(r => r.every(c => c !== 0))) {
                gameActive = false;
                updateStatus("Match Nul !");
                return true;
            }

            // Changement Joueur
            currentPlayer = (player === 1) ? 2 : 1;
            
            let nextName = `Joueur ${currentPlayer}`;
            if (currentMode === 'ai' && currentPlayer === 2) nextName = "IA (r√©fl√©chit...)";
            
            updateStatus(`Tour : ${nextName}`);
            
            return true;
        }

        function aiMove() {
            // IA Simple : Cherche un coup gagnant, sinon bloque, sinon al√©atoire
            let chosenCol = -1;

            // 1. Essayer de gagner ou bloquer (Simulation simplifi√©e)
            // Pour faire simple ici : IA purement al√©atoire mais valide
            // Am√©lioration possible : Minimax ici
            
            const validCols = [];
            for(let c=0; c<COLS; c++) {
                if(boardState[0][c] === 0) validCols.push(c);
            }

            if(validCols.length > 0) {
                // Choisir une colonne au hasard parmi les valides
                chosenCol = validCols[Math.floor(Math.random() * validCols.length)];
                
                // Petite astuce : pr√©f√©rer le centre (colonnes 2, 3, 4)
                const centerCols = validCols.filter(c => c >= 2 && c <= 4);
                if(centerCols.length > 0 && Math.random() > 0.3) {
                    chosenCol = centerCols[Math.floor(Math.random() * centerCols.length)];
                }
            }

            playMove(chosenCol, 2);
            isAiThinking = false;
        }

        function animateToken(row, col, player) {
            const cell = document.querySelector(`.cell[data-r='${row}'][data-c='${col}']`);
            const token = document.createElement('div');
            token.className = `token p${player}`;
            
            // Calcul distance chute (pixels)
            // -100px pour partir d'un peu plus haut que la grille
            const dropHeight = -((row * 60) + (row * 8) + 100); 
            token.style.setProperty('--drop-start', `${dropHeight}px`);
            
            token.classList.add('falling');
            cell.appendChild(token);
        }

        function checkWin(r, c, player) {
            const dirs = [[0,1], [1,0], [1,1], [1,-1]]; // Horiz, Vert, Diag1, Diag2
            
            for(let d of dirs) {
                let count = 1;
                // Sens +
                let i = 1;
                while(true) {
                    const nr = r + d[0]*i, nc = c + d[1]*i;
                    if(nr<0 || nr>=ROWS || nc<0 || nc>=COLS || boardState[nr][nc] !== player) break;
                    count++; i++;
                }
                // Sens -
                i = 1;
                while(true) {
                    const nr = r - d[0]*i, nc = c - d[1]*i;
                    if(nr<0 || nr>=ROWS || nc<0 || nc>=COLS || boardState[nr][nc] !== player) break;
                    count++; i++;
                }

                if(count >= winCondition) return true;
            }
            return false;
        }

        function updateStatus(msg) {
            statusEl.textContent = msg;
            if(msg.includes("gagn√©")) {
                statusEl.style.color = "#4cd137"; // Vert victoire
            } else {
                statusEl.style.color = "white";
            }
        }

    </script>
</body>
</html>
